<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOMADS TACTICAL TERMINAL v9.5</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#A60000">

    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Teko:wght@500;700&display=swap" rel="stylesheet">
    <script src="nomads_db.js"></script>

    <style>
        :root {
            --bg-color: #0b0c10; --panel-bg: #1f1f1f; --nomad-red: #cc0000; 
            --nomad-darkred: #8b0000; --nomad-orange: #ff6600; 
            --text-main: #f0f0f0; --text-dim: #aaaaaa;
        }
        body { background: var(--bg-color); color: var(--text-main); font-family: 'Share Tech Mono', monospace; padding: 10px; border: 2px solid var(--nomad-red); min-height: 100vh; box-sizing: border-box; margin: 0; display: flex; flex-direction: column; }
        h2 { font-family: 'Teko', sans-serif; font-size: 28px; color: #fff; text-shadow: 2px 2px 0px var(--nomad-red); text-align: center; text-transform: uppercase; border-bottom: 2px solid var(--nomad-red); padding-bottom: 5px; margin-top: 0; margin-bottom: 15px;}
        
        .section { background: var(--panel-bg); border-left: 4px solid var(--nomad-red); padding: 10px; margin-bottom: 10px; box-shadow: 2px 2px 10px rgba(0,0,0,0.5); }
        input, select { background: #000; color: var(--text-main); border: 1px solid var(--nomad-red); width: 100%; padding: 15px; margin: 5px 0; font-size: 16px; box-sizing: border-box; }
        
        /* BOTTONI STANDARD SETUP */
        .btn-nomad { width: 100%; background: linear-gradient(135deg, var(--nomad-red) 0%, var(--nomad-darkred) 100%); color: #fff; padding: 15px; margin-top: 5px; cursor: pointer; font-family: 'Teko', sans-serif; font-size: 22px; font-weight: bold; text-transform: uppercase; border: none; clip-path: polygon(5% 0, 100% 0, 95% 100%, 0 100%); }
        .btn-status { width: 100%; background: #222; color: var(--nomad-red); border: 2px solid var(--nomad-red); padding: 15px; margin-top: 15px; font-family: 'Teko', sans-serif; font-size: 22px; font-weight: bold; cursor: pointer; }
        
        /* BOTTONI ENORMI PER LA BATTAGLIA */
        .grid-buttons { display: flex; flex-direction: column; gap: 10px; flex-grow: 1; }
        .huge-btn { flex: 1; min-height: 80px; background: #1a0000; border: 2px solid var(--nomad-red); color: #fff; font-family: 'Teko', sans-serif; font-size: 32px; font-weight: bold; text-transform: uppercase; display: flex; align-items: center; justify-content: center; flex-direction: column; cursor: pointer; transition: 0.2s; border-radius: 5px; padding: 10px; text-align: center; line-height: 1.1; }
        .huge-btn:active { background: var(--nomad-orange); color: #000; transform: scale(0.98); }
        .huge-btn span { font-family: 'Share Tech Mono', monospace; font-size: 14px; color: var(--nomad-orange); font-weight: normal; margin-top: 5px; }

        .flex-row { display: flex; gap: 10px; }
        .step-container { display: none; flex-direction: column; height: 100%; flex-grow: 1; overflow-y: auto;}
        .active-step { display: flex; }
        
        #battle-header { text-align: center; color: var(--nomad-orange); font-size: 18px; font-weight: bold; margin-bottom: 10px; padding: 10px; background: #222; border: 1px dashed var(--nomad-orange); }
    </style>
</head>
<body>
    <h2>-- TUNGUSKA DATANET --</h2>
    
    <div id="setup">
        <div class="section">
            <h3 style="margin-top:0; color: var(--nomad-orange);">SCHIERAMENTO TRUPPE</h3>
            <div class="flex-row">
                <select id="groupSelect" style="flex:2;" onchange="updateProfileSelect()"><option value="">-- 1. TRUPPA --</option></select>
                <select id="combatGroup" style="flex:1;">
                    <option value="1">GRUPPO 1</option>
                    <option value="2">GRUPPO 2</option>
                </select>
            </div>
            <select id="profileSelect" disabled><option value="">-- 2. SELEZIONA PROFILO --</option></select>
            <input type="text" id="unitAlias" placeholder="3. ASSEGNA SOPRANNOME (Opzionale)">
            <button class="btn-nomad" onclick="addUnitToRoster()">SCHIERA UNITÀ</button>
            <div id="localRoster" style="margin-top:10px; font-size:12px; border-top:1px dashed red; padding-top:10px;"></div>
        </div>
        <button class="btn-status" onclick="startBattle()">INIZIA PARTITA</button>
    </div>

    <div id="battle" style="display:none; flex-grow: 1; flex-direction: column;">
        <div id="battle-header">SELEZIONA GRUPPO DI COMBATTIMENTO</div>

        <div id="step-group" class="step-container active-step">
            <div class="grid-buttons">
                <button class="huge-btn" onclick="goToStep('step-unit', 1)">GRUPPO 1 <br><span>(Ordini Principali)</span></button>
                <button class="huge-btn" onclick="goToStep('step-unit', 2)">GRUPPO 2 <br><span>(Ordini Secondari)</span></button>
            </div>
        </div>

        <div id="step-unit" class="step-container">
            <div class="grid-buttons" id="unit-buttons-container">
                </div>
            <button class="btn-status" onclick="goToStep('step-group')">INDIETRO</button>
        </div>

        <div id="step-action" class="step-container">
            <div class="grid-buttons">
                <button class="huge-btn" onclick="selectAction('MOVIMENTO')">MOVIMENTO <span>(Innesca ARO)</span></button>
                <button class="huge-btn" onclick="selectAction('ATTACCO BS')">ATTACCO BS <span>(Fuoco a Distanza)</span></button>
                <button class="huge-btn" onclick="selectAction('CORPO A CORPO')">CORPO A CORPO <span>(Mischia)</span></button>
                <button class="huge-btn" onclick="selectAction('SCHIVATA')">SCHIVATA <span>(Dodge)</span></button>
                <button class="huge-btn" onclick="selectAction('ABILITÀ')">ABILITÀ <span>(Cura, Hack, Scoprire)</span></button>
                
                <button class="huge-btn" style="border-color: #aaa;" onclick="selectAction('GESTIONE STATI')">GESTIONE STATI <span>(Targato, Inconscio, Rimosso...)</span></button>
            </div>
            <button class="btn-status" onclick="goToStep('step-unit')">ANNULLA</button>
        </div>

        <div id="step-states" class="step-container">
            <div class="grid-buttons">
                <button class="huge-btn" style="background:#003300; border-color:#00ff00;" onclick="applyState('ACTIVE')">ATTIVO / RIPRISTINATO <span>(Rimuove malus/stati)</span></button>
                
                <button class="huge-btn" style="background:#330000; border-color:#ff0000;" onclick="applyState('DEAD')">MORTO / RIMOSSO <span>(Rimuove la truppa)</span></button>
                <button class="huge-btn" style="background:#331a00; border-color:#ffaa00;" onclick="applyState('UNCONSCIOUS')">INCONSCIO <span>(A terra, curabile)</span></button>
                
                
